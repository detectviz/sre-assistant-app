# SRE Assistant APP Plugin 憲法

## 核心原則

### I. Grafana 插件標準遵循（必須遵守）
所有程式碼與架構設計必須嚴格遵循 Grafana 插件開發規範，包括：
- 插件類型正確設定（App Plugin）
- 後端實作使用 grafana-plugin-sdk-go
- 前端使用 React + TypeScript + Grafana Scenes SDK
- 安全配置透過 plugin.json 的 secureJsonData
- 避免在插件中執行任意程式碼
- 正確實作資源處理器與健康檢查

### II. SRE 最佳實踐整合（必須遵守）
插件功能必須體現 SRE 核心價值觀：
- 可靠性優先：所有功能需包含錯誤處理與降級機制
- 自動化導向：提供自動化診斷與修復建議
- 數據驅動決策：所有建議需基於可觀測性數據
- 使用者體驗至上：介面設計考慮運維人員實際工作流程

### III. AI/LLM 安全整合（必須遵守）
AI 功能實作必須確保安全與可控：
- 所有 LLM 請求需驗證可用性檢查
- 敏感資訊不得透過 AI 介面傳輸
- MCP 工具呼叫需實作適當的錯誤處理
- AI 生成內容需標記為 AI 輔助而非最終決策
- 避免將使用者認證資訊暴露給 AI 服務

### IV. 可觀察性與安全性（必須遵守）
插件本身需實作完善的可觀察性：
- 結構化日誌記錄，區分 debug/info/error 等級
- 指標收集：查詢延遲、錯誤率、成功率
- 審計追蹤：所有自動化動作與 AI 建議需記錄
- 租戶隔離：正確處理多組織存取控制
- 機密資訊安全儲存與傳輸

### V. 程式碼品質與測試（必須遵守）
開發流程必須確保高品質輸出：
- TypeScript 嚴格模式啟用，完整類型覆蓋
- 單元測試覆蓋率至少 80%，包含錯誤路徑
- E2E 測試驗證完整使用者流程
- ESLint 與 Prettier 配置，自動化程式碼格式化
- Go 程式碼遵循標準格式化與測試慣例

### VI. 文件化與維護性（必須遵守）
專案維護必須可持續：
- 所有 API 與組件需完整 TypeScript 註解
- 架構決策記錄在 architecture.md
- 變更記錄維護在 CHANGELOG.md
- README 提供完整安裝與使用指南
- 程式碼變更需對應測試與文件更新

### VII. 效能與擴充性（必須遵守）
架構設計需考慮長期可維護性：
- 前端程式碼分割，避免單一 bundle 過大
- 後端 API 設計考慮並發請求處理
- 快取策略實作，避免重複查詢外部資料源
- 資源使用監控，防止記憶體洩漏
- 模組化設計，便於功能擴充與維護

## 技術標準與限制

### 技術棧要求
- 前端：React 18+, TypeScript 5.5+, Grafana Scenes 6.10+
- 後端：Go 1.21+, grafana-plugin-sdk-go
- 測試：Jest, Playwright, Go testing
- 建構：Webpack 5+, SWC, Esbuild
- 依賴管理：npm, Go modules

### 安全要求
- 所有外部 API 呼叫需實作逾時機制
- 使用者輸入驗證與清理
- HTTPS 強制使用
- 敏感配置透過環境變數或安全儲存
- 日誌不得包含密碼或個人識別資訊

### 效能標準
- 前端 bundle 大小限制：250KB 以下（經壓縮）
- API 回應時間：P95 < 2秒
- 並發處理能力：至少 100 同時使用者
- 資源使用：記憶體 < 200MB，CPU < 50%

## 開發工作流程

### 程式碼審查要求
- 所有 PR 需通過自動化檢查（lint, test, build）
- 至少一位資深開發者審查
- 安全性審查：特別檢查 AI 整合與外部 API 呼叫
- 效能審查：確保無明顯效能回歸

### 測試門檻
- 單元測試：新功能覆蓋率 > 90%
- 整合測試：所有 API 端點與資料流
- E2E 測試：關鍵使用者流程
- 效能測試：負載測試驗證擴充性

### 發佈流程
- 版本遵循語意化版本控制
- 主要版本需完整回歸測試
- 插件簽署以符合 Grafana 官方要求
- 發佈前在測試環境完整驗證

## 治理

憲法為專案最高指導原則，所有技術決策與程式碼變更必須符合上述原則。

### 修憲程序
- 修憲提案需詳細說明理由與影響評估
- 獲得團隊多數同意後方可修訂
- 版本號碼遵循語意化版本：
  - MAJOR：原則移除或重大重新定義
  - MINOR：新增原則或重大功能擴充
  - PATCH：文字修正、非重大調整

### 遵循驗證
- 所有程式碼變更需通過 constitution check
- 新功能開發前需評估對原則的遵循程度
- 定期審查現有程式碼是否符合憲法要求

**版本**: 1.0.0 | **通過日期**: 2025-10-13 | **上次修訂**: 2025-10-13